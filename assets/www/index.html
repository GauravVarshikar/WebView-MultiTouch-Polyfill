<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<link href="wmp.css" rel="stylesheet" type="text/css">

<script type="text/javascript">
			var nativeTapCount = 0;
			var maxNativeTapCount = 0;
			var tapCount = 0;
			var maxTapCount = 0;
			var print = function (obj, maxDepth, prefix){
			var result = '';
			if (!prefix) prefix='';
			for(var key in obj){
				if (typeof obj[key] == 'object'){
					if (maxDepth !== undefined && maxDepth <= 1){
						result += (prefix + key + '=object [max depth reached]\n');
					} else {
						result += print(obj[key], (maxDepth) ? maxDepth - 1: maxDepth, prefix + key + '.');
					}
				} else {
					result += (prefix + key + '=' + obj[key] + '\n');
				}
			}
			return result;
			};

			function tellJsWorking() {
				divs.js.setAttribute('class', 'ok');
				divs.js.textContent = 'Javascript works - Display ' + document.body.offsetHeight + 'x' + document.body.offsetWidth;
			}

			function tellInjectionWorking(deviceInfo, androidInfo) {
				divs.inject.setAttribute('class', 'ok');
				divs.inject.innerHTML = 'Injection of Javascript from Android Code works!';
				if (deviceInfo.length > 0)
					divs.inject.innerHTML += '<br/>Device Info read from android.os.Build:<br/>'
							+ '<span style="font-family: monospace">' + deviceInfo + '<br/>'
							+ androidInfo +'</span>';

				divs.info.removeAttribute('class');
				divs.info.textContent = 'Now put 1+ fingers on the screen to see how many your device recognises.';
			}

			function tellTouchDevice() {
				if (!isTouchDevice())
					return;

				divs.touch.setAttribute('class', 'ok');
				divs.touch.innerHTML = 'This a touch device.';
			}

			function incrementTapCount() {
				++tapCount;
				updateTapCount();
			}

			function decrementTapCount() {
				--tapCount;
				updateTapCount();
			}

			function touchListener(e) {
//				console.log(e);
//				debug(e.type + e.identifier);
				nativeTapCount = e.touches.length;
				updateNativeTapCount();
//				e.preventDefault();
			}

			function updateNativeTapCount() {
				if (nativeTapCount > maxNativeTapCount)
					maxNativeTapCount = nativeTapCount;

				divs.ntap.innerHTML = 'Currently recognised (touch-API): ' + nativeTapCount + ' touch(es)<ul><li>High score: ' + maxNativeTapCount + ' simultaneous touches</li></ul>';
				divs.ntap.setAttribute('class', 'ok');
			}


			function updateTapCount() {
				if (tapCount > 0)
					divs.tap.setAttribute('class', 'ok');

				if (tapCount > maxTapCount)
					maxTapCount = tapCount;

				divs.tap.innerHTML = 'Currently recognised (polyfill-able): ' + tapCount + ' touch(es)<ul><li>High score: ' + maxTapCount + ' simultaneous touches</li></ul>';

				if (maxTapCount > 1) {
					divs.info.setAttribute('class', 'awesome');
					divs.info.innerHTML = '>2 parallel taps registered! See high scores above.</a>';
				}
			}

			function isTouchDevice(){
				try{
					document.createEvent("TouchEvent");
					return true;
				}catch(e){
					return false;
				}
			}

			function debug(text, startNewLog)
			{
				if (startNewLog)
					return divs.debug.innerHTML = '<pre>' + text;

				return divs.debug.innerHTML = text + '\n' + divs.debug.innerHTML;
			}

			window.onload = function() {
				divs =  {
					js: document.getElementById('test-js'),
					inject: document.getElementById('test-inject'),
					touch: document.getElementById('test-touch'),
					ntap: document.getElementById('test-native'),
					tap: document.getElementById('test-tap'),
					debug: document.getElementById('debug'),
					info: document.getElementById('info')
				};

				addEventListener('touchstart', touchListener, true);
				addEventListener('touchend', touchListener, true);
				addEventListener('touchmove', touchListener, true);
				addEventListener('touchcancel', touchListener, true);

				tellJsWorking();
				tellTouchDevice();
			}
		</script>

	</head>
	<body id="body">
		<ul>
			<li class="ok">Greetings, Earthling!</li>
			<li id="test-js" class="bad">Javascript is not enabled your WebView :(</li>
			<li id="test-touch" class="bad">This is not a Touch Device (doesn't know "TouchEvent")</li>
			<li id="test-inject" class="hidden">Injection of Javascript from Java Code is not working :(</li>
			<li id="test-native" class="hidden">No Javascript Touch events registered.</li>
			<li id="test-tap" class="hidden"></li>
		</ul>
		<div id="info-wrapper">
			<div id="info" class="hidden"></div>
			<button ontouchstart="window.location.href='test-pages/touchspector.html'">Visualise Touches</button>
		</div>
		<div><pre id="debug"></pre></div>
	</body>
</html>
